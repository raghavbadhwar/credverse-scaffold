(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[927],{6297:function(e,t,r){Promise.resolve().then(r.bind(r,278))},278:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return l}});var a=r(7437),n=r(2265),i=r(9501),s=r(7419),o=r(467),c=r(257);function l(){let{register:e,handleSubmit:t,reset:l}=(0,i.cI)(),[d,u]=(0,n.useState)(!1),[h,p]=(0,n.useState)(null),[f,m]=(0,n.useState)(null),w=async e=>{try{u(!0);let t=c.env.NEXT_PUBLIC_DEMO_ISSUER_PRIVATE_KEY||"";if(!t){let{Wallet:e}=await r.e(339).then(r.bind(r,9339));t=e.createRandom().privateKey}let a=new s.eG(t,"did:pkh:eip155:80002:0xYourIssuerAddress"),n={version:"1.0.0",templateId:e.templateId,tags:["degree"],category:"degree",level:"intermediate",language:"en",region:"IN",compliance:{gdpr:!0,dpdp:!0}},{templateId:i,...d}=e,h=await a.createCredential(d,n,i),f=await a.signCredential(h),w=await a.storeToIPFS(f),y=await a.storeToArweave(f),g=(0,s.h6)(f),v=await (0,o.g6)(g,f.id,w,y);m(v.hash||""),p({...f,metadata:{...f.metadata,ipfsHash:w,arweaveId:y,blockchainHash:g}}),l()}catch(e){alert(e.message||"Failed to issue credential")}finally{u(!1)}};return(0,a.jsxs)("div",{className:"max-w-3xl mx-auto py-10 px-4",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"Issue Credential"}),(0,a.jsxs)("form",{onSubmit:t(w),className:"space-y-4 card",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsx)("input",{className:"input-field",placeholder:"Student ID",...e("studentId",{required:!0})}),(0,a.jsx)("input",{className:"input-field",placeholder:"Student Name",...e("studentName",{required:!0})}),(0,a.jsx)("input",{className:"input-field",placeholder:"Student Email",type:"email",...e("studentEmail",{required:!0})}),(0,a.jsx)("input",{className:"input-field",placeholder:"Program Name",...e("programName",{required:!0})}),(0,a.jsx)("input",{className:"input-field",placeholder:"Institution Name",...e("institutionName",{required:!0})}),(0,a.jsx)("input",{className:"input-field",placeholder:"Graduation Date (YYYY-MM-DD)",...e("graduationDate",{required:!0})}),(0,a.jsx)("input",{className:"input-field",placeholder:"Template ID (e.g., degree-template)",...e("templateId",{required:!0})})]}),(0,a.jsx)("button",{className:"btn-primary",type:"submit",disabled:d,children:d?"Issuingâ€¦":"Issue Credential"})]}),h&&(0,a.jsxs)("div",{className:"card mt-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Issued Credential"}),f&&(0,a.jsx)("a",{className:"btn-secondary",href:"https://amoy.polygonscan.com/tx/".concat(f),target:"_blank",rel:"noreferrer",children:"View Tx"})]}),(0,a.jsx)("pre",{className:"mt-4 whitespace-pre-wrap break-all text-sm bg-gray-50 p-4 rounded",children:(0,s.lw)(h)})]})]})}},467:function(e,t,r){"use strict";async function a(){throw arguments.length>0&&void 0!==arguments[0]&&arguments[0],Error("Missing NEXT_PUBLIC_CREDENTIAL_REGISTRY_ADDRESS")}async function n(e,t,r,n){let i=await a(!1),s=await i.anchorCredential(e,t,r,n);return await s.wait()}async function i(e){let t=await a(!0),r=await t.verifyCredential(e);return{isValid:r[0],issuer:r[1],timestamp:r[2],isRevoked:r[3]}}r.d(t,{Tc:function(){return i},g6:function(){return n}}),r(4776),r(5810)},7419:function(e,t,r){"use strict";r.d(t,{Ab:function(){return f},eG:function(){return d},h6:function(){return u},lw:function(){return m}});var a=r(2211),n=r(8393),i=r(4355),s=r(135),o=r(9478),c=r(257),l=r(2957).lW;class d{async createCredential(e,t,r){return{"@context":["https://www.w3.org/2018/credentials/v1","https://credverse.in/contexts/v1"],id:this.generateCredentialId(),type:["VerifiableCredential","CredVerseCredential",r],issuer:this.issuerDID,issuanceDate:new Date().toISOString(),credentialSubject:e,metadata:{...t,blockchainHash:"",issuerDID:this.issuerDID,templateId:r}}}async signCredential(e){try{let t=new a.w(this.issuerPrivateKey),r=this.hashCredential(e),n=await t.signMessage(r),i={type:"EthereumEip712Signature2021",created:new Date().toISOString(),verificationMethod:"".concat(this.issuerDID,"#keys-1"),proofPurpose:"assertionMethod",proofValue:n};return{...e,proof:i}}catch(e){throw Error("Failed to sign credential: ".concat(e))}}async verifyCredential(e){try{if(!e.proof)return!1;let{proof:t,...r}=e,a=this.hashCredential(r),s=n.n(a,t.proofValue),o=e.issuer;if("string"==typeof o&&o.startsWith("did:pkh:")){let e=o.split(":"),t=e[e.length-1];return s.toLowerCase()===t.toLowerCase()}let c=await this.resolveDIDPublicKey(o),l=i.d(c);return s.toLowerCase()===l.toLowerCase()}catch(e){return console.error("Credential verification failed:",e),!1}}async anchorToBlockchain(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{let t=this.hashCredential(e);return s.w(o.Y0(t+Date.now()))}catch(e){throw Error("Failed to anchor credential to blockchain: ".concat(e))}}async storeToIPFS(e){try{let t;let a=c.env.IPFS_ENDPOINT||"https://ipfs.infura.io:5001/api/v0",n=c.env.IPFS_PROJECT_ID,i=c.env.IPFS_PROJECT_SECRET,{create:s}=await Promise.all([r.e(283),r.e(897)]).then(r.bind(r,6283));if(n&&i){let e="".concat(n,":").concat(i);"undefined"!=typeof btoa?t="Basic "+btoa(e):void 0!==l&&(t="Basic "+l.from(e).toString("base64"))}let o=s({url:a,headers:t?{Authorization:t}:void 0}),d={...e,storedAt:new Date().toISOString(),storageProvider:"ipfs"},{cid:u}=await o.add(JSON.stringify(d));return u.toString()}catch(t){return s.w(o.Y0(JSON.stringify(e)))}}async storeToArweave(e){try{let t=c.env.ARWEAVE_HOST||"arweave.net",a=Number(c.env.ARWEAVE_PORT||443),n=c.env.ARWEAVE_PROTOCOL||"https",i=c.env.ARWEAVE_JWK?JSON.parse(c.env.ARWEAVE_JWK):null;if(!i)return"";let s=await r.e(93).then(r.t.bind(r,7093,23)),o=(s.default||s).init({host:t,port:a,protocol:n}),l={...e,storedAt:new Date().toISOString(),storageProvider:"arweave"},d=await o.createTransaction({data:JSON.stringify(l)},i);d.addTag("Content-Type","application/json"),await o.transactions.sign(d,i);let u=await o.transactions.post(d);if(200===u.status||202===u.status)return d.id;return""}catch(e){return""}}async revokeCredential(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{return!0}catch(e){throw Error("Failed to revoke credential: ".concat(e))}}async isCredentialRevoked(e){try{return!1}catch(e){return console.error("Failed to check credential revocation status:",e),!1}}generateCredentialId(){let e=Date.now(),t=Math.random().toString(36).substring(2);return"urn:credverse:credential:".concat(e,":").concat(t)}hashCredential(e){let t=h(e);return s.w(o.Y0(JSON.stringify(t)))}normalizeCredential(e){return h(e)}sortObjectKeys(e){return p(e)}async resolveDIDPublicKey(e){try{throw Error("Unsupported DID method: ".concat(e))}catch(e){throw Error("Failed to resolve DID: ".concat(e))}}constructor(e,t){this.issuerPrivateKey=e,this.issuerDID=t}}function u(e){let t=h(e);return s.w(o.Y0(JSON.stringify(t)))}function h(e){let{proof:t,...r}=e||{};return p(r)}function p(e){if(null===e||"object"!=typeof e)return e;if(Array.isArray(e))return e.map(e=>p(e));let t={};return Object.keys(e).sort().forEach(r=>{t[r]=p(e[r])}),t}function f(e){return"".concat("http://localhost:3000","/verify/").concat(e.id)}function m(e){return JSON.stringify(e,null,2)}}},function(e){e.O(0,[303,470,971,117,744],function(){return e(e.s=6297)}),_N_E=e.O()}]);